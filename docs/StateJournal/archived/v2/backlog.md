# StateJournal Backlog

> æœ€åæ›´æ–°ï¼š2025-12-27
> ç»´æŠ¤è€…ï¼šAI Team
> 
> **é¡¹ç›®ä½ç½®**ï¼š`atelia/docs/StateJournal/`
> **å‘½åå†³è®®**ï¼š[2025-12-21 å‘½åæŠ•ç¥¨](../../../agent-team/meeting/2025-12-21-hideout-durableheap-naming-and-repo.md)

---

## âœ… å·²å®Œæˆä»»åŠ¡

### 2025-12-27 ç•…è°ˆä¼š #6 â€” Workspace å­˜å‚¨å±‚é›†æˆ

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç•…è°ˆä¼š #6 | âœ… | Workspace å­˜å‚¨å±‚é›†æˆè®¾è®¡ |
| æ ¸å¿ƒæ¶æ„å†³ç­– | âœ… | Workspace æ˜¯ä¸»åŠ¨åè°ƒå™¨ï¼ŒMaterializer å†…ç½® |
| API å¤–è§‚è®¾è®¡ | âœ… | B2 æ–¹æ¡ˆ + LoadRoot è¯­æ³•ç³– |
| æ¡æ¬¾è‰æ¡ˆ | âœ… | 5 æ¡ P0 + 3 æ¡ P1 |

> **ç›¸å…³è®°å½•**ï¼š[ç•…è°ˆä¼š #6](../../../agent-team/meeting/2025-12-27-workspace-storage-integration.md)

### 2025-12-26 L1 å®¡é˜…ä¸è§„èŒƒä¿®è®¢

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| L1 å…¨é‡å®¡é˜… | âœ… | 4 æ¨¡å— 60 æ¡æ¬¾ï¼Œ54C/2V/4U |
| V-1: DiscardChanges Detached | âœ… | æ”¹ä¸º no-opï¼Œæµ‹è¯•æ›´æ–° |
| V-2: TryGetValue è¿”å›ç±»å‹ | âœ… | è§„èŒƒä¿®è®¢ä¸ºä¸‰åˆ†ç±» |
| AteliaResult v1.1 | âœ… | æ–°å¢ `[ATELIA-BOOL-OUT-WHEN]` ç­‰æ¡æ¬¾ |
| ç•…è°ˆä¼š #1: AteliaResult è¾¹ç•Œ | âœ… | ä¸‰ä½é¡¾é—®å…±è¯† |
| ç•…è°ˆä¼š #2: DurableDict API | âœ… | éƒ¨åˆ†æ‰¹å‡† |

> **ç›¸å…³è®°å½•**ï¼š
> - [L1 å®¡é˜…æ±‡æ€»](review/L1-Full-Review-Summary.md)
> - [MVP è¾¹ç•Œåˆ’åˆ†](mvp-boundary.md)
> - [ç•…è°ˆä¼š #1](../../../agent-team/meeting/StateJournal/2025-12-26-ateliaresult-boundary.md)
> - [ç•…è°ˆä¼š #2](../../../agent-team/meeting/StateJournal/2025-12-26-durabledict-api-design.md)

### 2025-12-22 è¿ç§»å®Œæˆ

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| é¡¹ç›®æ›´å | âœ… | DurableHeap â†’ StateJournal |
| æ–‡æ¡£è¿ç§» | âœ… | è¿å…¥ `atelia/docs/StateJournal/` |
| åç§°æ›¿æ¢ | âœ… | å…¨éƒ¨æ–‡æ¡£æ‰¹é‡æ›¿æ¢å®Œæˆ |

### 2025-12-21 MVP v2 å®¡é˜…ä¿®è®¢

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| P0-2ï¼šæ¡æ¬¾ ID å‡çº§ä¸ºç¨³å®šè¯­ä¹‰é”šç‚¹ | âœ… | 43 ä¸ªæ¡æ¬¾å…¨éƒ¨é‡å‘½å |
| P0-1ï¼šState æšä¸¾å‡çº§ä¸ºæ ¸å¿ƒ API | âœ… | æ–°å¢ 4 æ¡æ¡æ¬¾ |
| P0-3ï¼š"å¿…é¡»å†™æ­»"å‡çº§ä¸ºæ¡æ¬¾ | âœ… | æ–°å¢ `[F-RECORD-WRITE-SEQUENCE]` |
| P0-4ï¼šåˆ é™¤æ³›å‹å†™æ³•çŸ›ç›¾ | âœ… | Â§3.4.5 |
| P1-5ï¼šError Affordance è§„èŒƒåŒ– | âœ… | æ–°å¢ 4 æ¡æ¡æ¬¾ + ErrorCode æšä¸¾ |
| P1-7ï¼šå‘½åä¸€è‡´æ€§ | âœ… | WriteDiff â†’ WritePendingDiff |
| P1-8ï¼šDiscardChanges ObjectId è¯­ä¹‰ | âœ… | æ–°å¢é”šç‚¹æ¡æ¬¾ |
| P1-9ï¼šåˆ é™¤ Modified Object Set | âœ… | æœ¯è¯­è¡¨ |

---

## ğŸ“‹ å¾…åŠä»»åŠ¡

### P0 ä¼˜å…ˆçº§ - å·²æ‰¹å‡†å·²å®æ–½ âœ…

| # | ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|---|------|------|------|
| **B-1** | éæ³›å‹ DurableDict æ”¹é€  | âœ… | ç•…è°ˆä¼š #2 æ‰¹å‡†ï¼Œå·²å®æ–½ |
| **B-2** | å¼•å…¥ ObjectId ç±»å‹ | âœ… | `Core/ObjectId.cs` |
| **B-3** | DurableDict ä¸ä½¿ç”¨ LazyRef | âœ… | å·²ç¡®è®¤ |

### P1 ä¼˜å…ˆçº§ - å¼€æ”¾é—®é¢˜ï¼ˆéœ€åç»­ç•…è°ˆä¼šï¼‰

| # | ä»»åŠ¡ | å¤æ‚åº¦ | è¯´æ˜ |
|---|------|--------|------|
| **B-4** | ~~DurableDict ä¸ Workspace ç»‘å®šæ–¹å¼~~ | âœ… | ç•…è°ˆä¼š #5 å·²è§£å†³ï¼ŒæŠ¤ç…§æ¨¡å¼ |
| **B-5** | **DurableDict API æˆå‘˜æ­£å¼å‘½å** | ä¸­ | å…ˆå®æ–½åŸºç¡€å†å®šåå­— |
| **B-6** | ~~Detached å¯¹è±¡æˆå‘˜è®¿é—®è¯­ä¹‰~~ | âœ… | ç•…è°ˆä¼š #3+#4 å·²è§£å†³ |
| **B-8** | **LoadObject<T> æ³›å‹/éæ³›å‹åˆ†å±‚** | ä½ | è€ƒè™‘æ‹†åˆ†ä¸ºéæ³›å‹åº•å±‚ + æ³›å‹è½¬æ¢åŒ…è£… |

> **B-8 è®¾è®¡æ€è·¯**ï¼ˆç›‘æŠ¤äºº 2025-12-27 æå‡ºï¼‰ï¼š
> - å½“å‰ `DurableObjectBase.LoadObject<T>()` å’Œ `Workspace.LoadObject<T>()` éƒ½æ˜¯æ³›å‹
> - å¯èƒ½åº”æ‹†åˆ†ä¸ºï¼šéæ³›å‹ `LoadObject(ulong id) -> IDurableObject` + æ³›å‹ `LoadObject<T>()` åŒ…è£…
> - ç†ç”±å¾…è®¨è®ºï¼šç±»å‹è½¬æ¢è¾¹ç•Œã€è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ä½ç½®ç­‰

### P2 ä¼˜å…ˆçº§ - å·²è®¾è®¡å¾…å®æ–½

| # | ä»»åŠ¡ | å¤æ‚åº¦ | è¯´æ˜ |
|---|------|--------|------|
| **B-7** | **DiagnosticScope (O6)** | ä¸­ | è¯Šæ–­ä½œç”¨åŸŸï¼Œå…è®¸è¯»å– Detached å¯¹è±¡æœ€åå·²çŸ¥å€¼ |
| **B-9** | **Workspace.Open + ObjectMaterializer** | é«˜ | ç•…è°ˆä¼š #6 å†³è®®ï¼Œé›†æˆ IRbfScanner |
| **B-10** | **ObjectKindRegistry å®ç°** | ä¸­ | Kind â†’ Codec/Factory æ˜ å°„ |
| **B-11** | **DurableArray çš„ DiffCodec** | ä¸­ | å¾…æ•°ç»„ç±»å‹è®¾è®¡å®Œæˆ |
| **B-12** | **Version Chain éå†ä¼˜åŒ–** | ä½ | å¤šç‰ˆæœ¬åˆå¹¶æ€§èƒ½ä¼˜åŒ– |

> **B-9 è®¾è®¡æ‘˜è¦** (ç•…è°ˆä¼š #6)ï¼š
> - API: `Workspace.Open(path)` / `Workspace.Open(path, options)`
> - æ ¸å¿ƒï¼šObjectMaterializer å†…éƒ¨ç±» + ObjectKindRegistry é…ç½®å…¥å£
> - æ¡æ¬¾ï¼šP0 äº”æ¡ + P1 ä¸‰æ¡ï¼ˆè§ç•…è°ˆä¼šè®°å½•ï¼‰
> - è¯¦è§: [ç•…è°ˆä¼šè®°å½•](../../../agent-team/meeting/2025-12-27-workspace-storage-integration.md)

> **B-7 è®¾è®¡æ‘˜è¦** (ç•…è°ˆä¼š #4)ï¼š
> - API: `StateJournal.Diagnostics.AllowStaleReads()`
> - å®ç°: `AsyncLocal<int>` + `IDisposable`
> - æ¡æ¬¾è‰æ¡ˆ: [DS-01]~[DS-08]
> - è¯¦è§: [ç•…è°ˆä¼šè®°å½•](../../../agent-team/meeting/StateJournal/2025-12-26-diagnostic-scope.md)

### P3 ä¼˜å…ˆçº§

| # | ä»»åŠ¡ | å¤æ‚åº¦ | è¯´æ˜ |
|---|------|--------|------|
| ~~2~~ | ~~LoadObject TryLoad è¯­ä¹‰æ ‡æ³¨~~ | ~~ä½~~ | âœ… å·²å®Œæˆ |
| ~~3~~ | ~~TryLoadObject è®¾è®¡æ€è·¯~~ | ~~ä¸­~~ | âœ… å·²å®Œæˆ |
| 4 | å®ç° StateJournal é”™è¯¯ç±»å‹æ´¾ç”Ÿç±» | ä½ | æŒ‰ ErrorCode æ³¨å†Œè¡¨å®ç° |

---

## ä¸‹ä¸€æ­¥ï¼šä»£ç å®ç°

| é˜¶æ®µ | å†…å®¹ | çŠ¶æ€ |
|------|------|------|
| è®¾è®¡ | MVP v2 è§„èŒƒ | âœ… å®Œæˆ |
| å®ç° | `Atelia.StateJournal` æ ¸å¿ƒç±»åº“ | ğŸ”œ å¾…å¼€å§‹ |
| æµ‹è¯• | æŒ‰ test-vectors ç¼–å†™æµ‹è¯• | ğŸ”œ å¾…å¼€å§‹ |

---

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| [mvp-design-v2.md](mvp-design-v2.md) | æ ¸å¿ƒè®¾è®¡æ–‡æ¡£ |
| [mvp-test-vectors.md](mvp-test-vectors.md) | æµ‹è¯•å‘é‡ |
| [decisions/mvp-v2-decisions.md](decisions/mvp-v2-decisions.md) | å†³ç­–è®°å½• |
