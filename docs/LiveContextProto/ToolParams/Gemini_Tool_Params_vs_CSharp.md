# Gemini API 工具参数与 C# 参数对比解析

## 1. 引言

本文档旨在详细阐述在与 Google Gemini Pro 等大型语言模型（LLM）交互时，其“工具（Tool）”功能中的参数是如何被定义、理解和使用的。我们将重点对比 Gemini API 中基于 JSON Schema 的参数规范与标准 C# 方法中的参数定义，以帮助开发者更好地在 C# 环境中设计和集成 LLM 的工具调用功能。

## 2. 核心概念：基于 JSON Schema 的参数定义

Gemini API 使用 **JSON Schema** 来描述其工具的函数签名，包括函数名、描述以及最重要的——参数。这种方式为动态、灵活地定义工具接口提供了坚实的基础。

### 2.1 JSON Schema 是什么？

JSON Schema 是一种用 JSON 格式来注解和验证 JSON 文档的词汇表。在 Gemini API 的上下文中，它被用来精确地描述一个工具（或函数）期望接收什么样的参数。

一个典型的参数定义可能包含以下关键字段：

-   `type`: 参数的数据类型，例如 `string`, `number`, `integer`, `boolean`, `object`, `array`。
-   `description`: 对参数用途的自然语言描述。**这一点至关重要**，因为 LLM 会依赖这个描述来理解参数的含义并决定如何填充它。
-   `properties`: 如果参数类型是 `object`，则此字段定义该对象包含的属性。
-   `required`: 一个字符串数组，列出 `properties` 中哪些是必需的。
-   `items`: 如果参数类型是 `array`，则此字段描述数组中元素的类型。
-   `enum`: 一个数组，提供一组预定义的可选值。

**示例：**

```json
{
  "type": "object",
  "properties": {
    "filePath": {
      "type": "string",
      "description": "需要读取的文件的绝对路径。"
    },
    "maxLines": {
      "type": "integer",
      "description": "要读取的最大行数（可选）。"
    }
  },
  "required": ["filePath"]
}
```

### 2.2 Gemini API 类型与 C# 类型的映射

| JSON Schema 类型 | 对应的 C# 类型 (常见)                                | 说明                                                                                                                            |
| :--------------- | :--------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------ |
| `string`         | `string`                                             | 直接映射。                                                                                                                      |
| `number`         | `double`, `float`, `decimal`                         | 通用数字类型，通常映射为浮点数。                                                                                                |
| `integer`        | `int`, `long`                                        | 整数类型。                                                                                                                      |
| `boolean`        | `bool`                                               | 布尔值。                                                                                                                        |
| `object`         | `class`, `struct`, `Dictionary<string, object>`      | 结构化数据。通常会定义一个专门的 C# 类来接收，或者使用字典进行动态处理。                                                          |
| `array`          | `List<T>`, `T[]`, `IEnumerable<T>`                   | 集合类型。`T` 是由 `items` 字段定义的类型。                                                                                     |
| `null`           | `null`                                               | 在 C# 中，这对应于可空类型 (`string?`, `int?`) 或引用类型的 `null` 值。                                                           |

## 3. 与标准 C# 参数的核心差异

| 特性               | Gemini API (JSON Schema)                                                                                             | 标准 C#                                                                                                                            | 分析与对比                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -
| **类型系统**       | **描述性、动态类型**。类型在运行时由 LLM 根据 `description` 和 `type` 字段决定和生成。                                   | **编译时、强类型**。类型在编译时就已确定，编译器会进行严格的类型检查。                                                                 | Gemini 的方式更灵活，允许在不修改 C# 代码的情况下调整工具行为；而 C# 的方式更安全、性能更高，在编译阶段就能发现大量错误。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -
| **元数据**         | **内置且核心**。`description` 是 LLM 理解参数的关键。`enum` 等字段直接指导 LLM 的行为。                               | **通过特性 (Attributes) 实现**。例如 `[Description("...")]`, `[Required]` 等，但这些是元数据，不直接参与编译时类型检查。 | Gemini 的设计中，描述性元数据是一等公民，直接影响功能逻辑。在 C# 中，特性通常用于反射、序列化或框架特定行为，与核心方法签名分离。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -
-
| **参数可选性**     | 通过 `required` 数组明确声明。不在 `required` 列表中的 `properties` 成员即为可选。                                     | 通过可空类型 (`int?`)、默认参数值 (`int count = 10`) 或方法重载实现。                                                              | JSON Schema 的方式是集中式的声明，而 C# 的方式则分散在每个参数的定义上。两者都能清晰地表达意图，但实现机制不同。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     -
| **结构化数据**     | 使用 `type: "object"` 和 `properties` 定义嵌套结构，或 `type: "array"` 和 `items` 定义数组。结构清晰，易于 LLM 理解。 | 使用 `class` 或 `struct` 定义复杂类型。类型安全，但在运行时不如 JSON 灵活。                                                        | 在 C# 端，最佳实践是为 `object` 类型的参数创建一个对应的 DTO (Data Transfer Object) 类，使用 `System.Text.Json` 或 `Newtonsoft.Json` 进行序列化和反序列化，这样既能享受强类型的好处，又能与 Gemini API 的 JSON 结构无缝对接。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     -

## 4. 最佳实践与 C# 实现策略

### 4.1 设计清晰的参数描述

-   **描述要为 LLM "着想"**：描述应该清晰、无歧义，准确说明参数的用途、格式要求和任何约束。LLM 不是编译器，它依赖这些文本来做出正确的判断。
-   **提供示例**：如果参数格式比较复杂（如特定格式的字符串），在描述中提供一个示例会非常有帮助。
-   **利用 `enum`**：当参数只有少数几个有效值时，使用 `enum` 可以极大地提高 LLM 调用的准确性。

### 4.2 在 C# 中处理工具调用

1.  **定义 DTO 类**：为每个工具的参数创建一个 C# 类。使用 `[JsonPropertyName("...")]` 特性可以确保 C# 属性名和 JSON 字段名正确匹配。

    ```csharp
    public class ReadFileParams
    {
        [JsonPropertyName("filePath")]
        public string FilePath { get; set; }

        [JsonPropertyName("maxLines")]
        public int? MaxLines { get; set; } // 使用可空类型表示可选
    }
    ```

2.  **动态生成 JSON Schema**：可以利用 C# 的反射机制，结合 `System.Text.Json` 或 `Newtonsoft.Json.Schema` 等库，从 DTO 类动态生成符合 Gemini 规范的 JSON Schema。这样可以确保 C# 代码和发送给 LLM 的工具定义始终保持同步。

3.  **解析和验证**：当收到 LLM 的函数调用请求时，其参数会以 JSON 字符串的形式提供。使用 `JsonSerializer.Deserialize<T>()` 将其反序列化为对应的 DTO 对象。在这个过程中，可以加入验证逻辑，确保所有 `required` 字段都存在，且数据类型正确。

### 4.3 版本控制与兼容性

-   **向后兼容**：在迭代工具时，尽量保持向后兼容。例如，新增的参数应该是可选的（不要加到 `required` 数组中）。
-   **版本化工具名**：如果必须进行破坏性更改，可以考虑在工具名中加入版本号（如 `readFile_v2`），同时保留旧版本，给模型一个过渡期。

## 5. 结论

Gemini API 的工具参数系统通过 JSON Schema 提供了一个强大而灵活的接口定义方式，它以“描述”为核心，与 C# 严格的、编译时的类型系统形成了有趣的对比。理解这两者之间的差异与联系，并采用合适的策略（如使用 DTO 和动态生成 Schema）进行桥接，是成功在 C# 应用中集成和利用 LLM 工具能力的关键。通过精心设计参数的 `description`，我们实际上是在“编程”语言模型，引导它更准确、更可靠地与我们的代码进行交互。
