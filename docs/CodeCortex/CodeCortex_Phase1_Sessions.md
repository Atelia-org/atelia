# CodeCortex Phase1 Sessions æ‰§è¡Œè®¡åˆ’ & è¿›åº¦è¿½è¸ª

> ç›®çš„ï¼šå°† Phase1 (S1~S10) çš„ç›®æ ‡ã€å…³é”®ä»»åŠ¡ã€äº§å‡ºç‰©ã€å¼•ç”¨æ–‡æ¡£ã€é€€å‡ºæ ‡å‡†ã€åº¦é‡ä¸é£é™©é›†ä¸­ï¼Œä¾¿äºæ¯æ—¥/æ¯æ¬¡å¼€å‘ä¼šè¯æ›´æ–°ã€‚æ–‡æ¡£æ˜¯â€œæ´»â€æ–‡ä»¶ï¼›è¿›åº¦å¤é€‰æ¡†éšå¼€å‘æ¨è¿›å‹¾é€‰ã€‚
>
> å…³è”ä¸»æ–‡æ¡£ï¼š`CodeCortex_Phase1.md` åŠé™„å½• (Hash è§„åˆ™ / ç¬¦å·è§£æ / å¢é‡ä¼ªä»£ç  / æŒ‡æ ‡ / AtomicIO / æµ‹è¯•å¤¹å…·)ã€‚

## ç›®å½•
- [ä¼šè¯æ¦‚è§ˆè¡¨](#ä¼šè¯æ¦‚è§ˆè¡¨)
- [å•ä¼šè¯è¯¦ç»†è®¡åˆ’](#å•ä¼šè¯è¯¦ç»†è®¡åˆ’)
- [æ»šåŠ¨è¿›åº¦ä¸é‡Œç¨‹ç¢‘](#æ»šåŠ¨è¿›åº¦ä¸é‡Œç¨‹ç¢‘)
- [é£é™©ç‡ƒå°½è¡¨](#é£é™©ç‡ƒå°½è¡¨)
- [åº¦é‡é‡‡é›†æ¸…å•](#åº¦é‡é‡‡é›†æ¸…å•)

---
## ä¼šè¯æ¦‚è§ˆè¡¨
| Session | ç›®æ ‡æ‘˜è¦ | å…³é”®äº§å‡º (Artifacts) | ä¸»è¦å‚è€ƒé™„å½• | é€€å‡ºæ ‡å‡† (ç®€) | é¢„è®¡å·¥æ—¶ |
|---------|----------|----------------------|--------------|--------------|----------|
| S1 Workspace & æ‰«æ | è§£å†³æ–¹æ¡ˆåŠ è½½ + ç±»å‹æšä¸¾ | `WorkspaceLoader` åˆç‰ˆ / æšä¸¾æ—¥å¿— | Incremental Flow Â§1~4 | è¾“å‡ºç±»å‹è®¡æ•°æ—¥å¿— | 0.5d |
| S2 Hash & Outline | Hash è®¡ç®— stub + åˆæ¬¡ Outline | `ITypeHasher` å®ç° / `IOutlineExtractor` / 1 ä¸ª outline æ–‡ä»¶ | TypeId & Hash Rules | â‰¥1 ç±»å‹ outline ç”Ÿæˆ | 1d |
| S3 Index æ„å»º | å†™å…¥ `index.json` + å¤ç”¨ | Index Writer/Reader + AtomicIO | AtomicIO & FileLayout | é‡å¯åå¤ç”¨æˆåŠŸ | 0.5d |
| S3.5 Quick Invalidation | Timestamp çº§å¿«é€Ÿå¤±æ•ˆåˆ¤å®š | FileManifest + ReuseDecider + æµ‹è¯• | Incremental Flow é™„å½• Â§Manifest | æœªå˜â†’å¤ç”¨ å˜æ›´â†’é‡å»º æ—¥å¿—å« Files/Changed | 0.25d |
| S4 ç¬¦å·è§£æ | ç²¾ç¡®/åç¼€/é€šé…/æ¨¡ç³Š | `SymbolResolver` + æµ‹è¯• | Symbol Resolve Algorithms | 4 ç±»æŸ¥è¯¢æµ‹è¯•è¿‡ | 0.5d |
| S5 Watcher & å¢é‡ | æ–‡ä»¶å˜æ›´ â†’ hash & outline æ›´æ–° | WatcherBatcher / ChangeDetector / IncrementalProcessor | Incremental Flow | ä¿®æ”¹1æ–‡ä»¶ <300ms | 1d |
| S6 Prompt çª—å£ | Outline-only Prompt Window | AccessTracker / PromptWindowBuilder | Status Metrics (é¢„ç®—æåŠ) | ç”Ÿæˆçª—å£æ–‡ä»¶ | 0.5d |
| S7 RPC æœåŠ¡ | JSON-RPC æœåŠ¡åŒ– | ServerHost / RpcHandlers | (ä¸»æ–‡æ¡£ Â§4) + AtomicIO | CLI å¯ RPC outline | 0.5d |
| S8 CLI å·¥å…· | å…¨éƒ¨å‘½ä»¤å°è£… | Commands/* | ä¸»æ–‡æ¡£ Â§4.2 | å…¨å‘½ä»¤æ‰§è¡ŒæˆåŠŸ | 0.5d |
| S9 æµ‹è¯•ä¸æ€§èƒ½ | è¦†ç›– + æ€§èƒ½åŸºå‡† | Test fixtures / Baselines | Test Fixtures Plan | åˆæ¬¡ç´¢å¼• â‰¤5s | 1d |
| S10 ç¨³å®šåŒ– | æ¸…ç† & æ–‡æ¡£ & æ—¥å¿— | README + æ—¥å¿—å®¡æ ¸ | Status Metrics / AtomicIO | DoD å…¨æ»¡è¶³ | 0.5d |

> æ³¨ï¼šå·¥æ—¶ä¸ºç›¸å¯¹ä¼°ç®—ï¼ˆäººå¤©ï¼‰ï¼Œå…·ä½“æŒ‰å¤æ‚åº¦è°ƒæ•´ï¼›å¹¶è¡Œå¯åœ¨ S4/S5 æœ‰ 60% è¿›åº¦æ—¶å¯åŠ¨ S7ã€‚

---
## å•ä¼šè¯è¯¦ç»†è®¡åˆ’
### S1 Workspace & æ‰«æ
- ç›®æ ‡ï¼šåŠ è½½ .sln / .csproj å¹¶æšä¸¾æ‰€æœ‰ `INamedTypeSymbol`ï¼ˆå…¬å…±+å†…éƒ¨ï¼‰ã€‚
- ä»»åŠ¡æ¸…å•ï¼š
  - [x] `MsBuildWorkspaceLoader` æ·»åŠ æ—¥å¿— + å¤±è´¥é‡è¯• (å®ç°ï¼š3 æ¬¡å°è¯• + çº¿æ€§é€€é¿ + Auto æ¨¡å¼å›é€€ Fallback)
  - [x] ç®€å•æšä¸¾å™¨ï¼š`ITypeEnumerator` æ¥å£ä¸å®ç° (`RoslynTypeEnumerator` é€’å½’å‘½åç©ºé—´/åµŒå¥—ç±»å‹)
  - [x] è¾“å‡ºç»Ÿè®¡ï¼šé¡¹ç›®æ•° / ç±»å‹æ•° â†’ `index_build.log` (`Summary Projects=14 Types=240 DurationMs=8.5~11.7s`)
- äº§å‡ºæ–‡ä»¶ï¼š`WorkspaceLoader.cs` (æ‰©å……), `TypeEnumerator.cs` (æ–°)
- å¼•ç”¨ï¼šé™„å½• *Incremental Flow* (åˆå§‹åŒ–æ®µ) / *AtomicIO*
- é€€å‡ºæ ‡å‡†ï¼šè¿è¡Œå‘½ä»¤ (ä¸´æ—¶ console) æ‰“å° â€œProjects=X Types=Yâ€ã€‚

æ‰§è¡Œæ‘˜è¦ï¼š
```
Force æ¨¡å¼ä¸€æ¬¡å®Œæ•´åŠ è½½: Projects=14 Types=240 Durationâ‰ˆ11.7s
Auto æ¨¡å¼åŠ è½½: Projects=14 Types=240 Durationâ‰ˆ8.6s
Fallback æ¨¡å¼éªŒè¯ï¼ˆç©º/å¼‚å¸¸è·¯å¾„ï¼‰: Adhoc Projects=1 Typesâ‰ˆ272 (èšåˆ .cs æ–‡ä»¶)
è®°å½•æ—¥å¿—æ–‡ä»¶: .codecortex/logs/index_build.log (åŒ…å« Attempt/Error/Warning/ Summary è¡Œ)
```
åå·®ä¸è¯´æ˜ï¼šåˆæ¬¡è€—æ—¶é«˜äº Phase1 ç›®æ ‡åŸºçº¿ï¼ˆâ‰¤5sï¼‰â€”â€”å“ˆå¸Œ/å¹¶è¡ŒåŒ–ä¸å»¶è¿Ÿå¼•ç”¨è§£æä¼˜åŒ–å°†åœ¨ S2/S3 å¼•å…¥ï¼Œä¸åœ¨ S1 ä¼˜åŒ–èŒƒå›´ã€‚

### S2 Hash & Outline
- ä»»åŠ¡ï¼š
  - [x] `TypeHasher`: 5 ç±» hash (ç»“æ„å“ˆå¸Œå·²åŠ å…¥è§„èŒƒæ’åº+æˆå‘˜ç­¾åæ ¼å¼ï¼›TODO: æ›´ç²¾ç»† Trivia å½’ä¸€)
  - [x] `OutlineExtractor`: æŒ‰ Phase1 æ ¼å¼è¾“å‡ºï¼ˆPublic API åˆ—è¡¨ï¼‰
  - [x] `TypeId` ç”Ÿæˆå·¥å…·ç±» (å«å†²çªæ—¥å¿— `hash_conflicts.log`)
  - [x] å…¨é‡ Outline å†™å…¥å‘½ä»¤ï¼š`codecortex outline-all <sln>` ç”Ÿæˆ `.codecortex/types/*.outline.md`
- éªŒè¯ï¼šæ‰‹å·¥ diff ä¸€ä¸ªç±»å‹çš„ç»“æ„ vs ä¿®æ”¹å†…éƒ¨å®ç° hash å·®å¼‚ã€‚
- é£é™©ï¼šRoslyn è¯­æ³•å¼‚å¸¸ã€‚ç¼“è§£ï¼štry/catchã€‚

æ‰§è¡Œæ‘˜è¦ï¼š
```
æ–°å¢å‘½ä»¤: outline-all  (ä¸ scan --gen-outlines å¹¶å­˜)
ç»“æ„å“ˆå¸Œï¼šæˆå‘˜æ’åºä¼˜å…ˆçº§=NestedType>Field>Property>Event>Methodï¼Œç­¾åå»å‚æ•°åï¼Œä»…ç±»å‹åºåˆ—ï¼›å¯ç¨³å®šé‡å»º
å¯æµ‹è¯•æ€§ï¼šå¼•å…¥ HasherIntermediate/IHashFunction/ITriviaStripperï¼Œæµ‹è¯•è¦†ç›–ç»“æ„ç¨³å®šä¸å®ç°å˜åŒ–
åˆæ¬¡ç”Ÿæˆï¼šOutlinesâ‰ˆ(public+internal ç±»å‹è®¡æ•°)ï¼›æ—¥å¿—æ¡ç›® OutlineAll Projects=.. Outlines=.. DurationMs=..
```
åå·®ä¸è¯´æ˜ï¼šCosmeticHash ä»ä¸ºç²—ç²’åº¦ï¼ˆå…¨æ–‡æ‹¼æ¥ï¼‰ã€‚åç»­é˜¶æ®µå¯æ›¿æ¢ä¸ºç»Ÿä¸€æ ¼å¼å½’ä¸€ã€‚

è°ƒè¯•å¼€å…³ï¼š
```
ç¯å¢ƒå˜é‡: CODECORTEX_TYPEHASH_DEBUG=1  (ä»å…¼å®¹æ—§çš„ CODECORTEX_DEBUG=1)
ä½œç”¨: TypeHasher åœ¨ Collect/Hash é˜¶æ®µè¾“å‡ºç»“æ„è¡Œã€æˆå‘˜æšä¸¾åŠæ–¹æ³•ä¸»ä½“é‡‡é›†é¢„è§ˆï¼ˆæˆªæ–­ï¼‰ã€‚
ä½¿ç”¨åœºæ™¯: è°ƒè¯•ç»“æ„å“ˆå¸Œä¸å˜ / å®ç°å“ˆå¸ŒæœªåŒºåˆ†çš„é—®é¢˜ï¼›é»˜è®¤ä¸è®¾ç½®é¿å…å™ªå£°ã€‚
```

### S3 Index æ„å»º
- ä»»åŠ¡ï¼š
  - [x] `IndexModel` + `IndexStore` (Load/Save)
  - [x] åŸå­å†™ + æŸåå›é€€ (AtomicFile.Replace + .bak å›é€€)
  - [x] å¯åŠ¨æ—¶å­˜åœ¨ index åŸºç¡€å¤ç”¨ (L0)
  - [x] S3.5: FileManifest æ—¶é—´æˆ³å¿«é€Ÿå¤±æ•ˆ (L1) + `IndexReuseDecider`
  - [x] å•æµ‹ï¼šå¤ç”¨ / ä¿®æ”¹æ–‡ä»¶å¤±æ•ˆ / åˆ é™¤æ–‡ä»¶å¤±æ•ˆ
- éªŒè¯ï¼šåˆ è¿›ç¨‹é‡å¯ outline ä¸é‡ç®—ï¼ˆæ¯”è¾ƒè®¡æ—¶ï¼‰ã€‚

æ‰§è¡Œæ‘˜è¦ï¼š
```
åˆæ¬¡æ„å»º: Summary Projects=.. Types=.. DurationMs=..
å¤ç”¨åˆ¤å®šæ—¥å¿—: ReuseDecision OK Files=N Changed=0 æˆ– ReuseDecision REBUILD Files=N Changed=k
CLI è¾“å‡º: Index reuse (timestamp): Files=N Changed=0 Projects=.. Types=..
Manifest: è®°å½•æ¯ä¸ªæºæ–‡ä»¶ LastWriteUtcTicks (åç»­å¢é‡åŸºç¡€)
```
åå·®ä¸è¯´æ˜ï¼šå½“å‰ä»…ä½¿ç”¨æ—¶é—´æˆ³ï¼›æœªå¯ç”¨å†…å®¹å“ˆå¸Œä»¥é™ä½ IOï¼›åç»­ L2/L3 å°†å¼•å…¥å·®å¼‚é›†åˆä¸å±€éƒ¨æ›´æ–°ã€‚

### S4 ç¬¦å·è§£æ
// ï¼ˆåŸè®¡åˆ’å« suffixTrie / LRU ç¼“å­˜ï¼Œå› è§„æ¨¡è¾ƒå°æš‚ç¼“ï¼Œå®ç°ä»¥çº¿æ€§é›†åˆä¸ºä¸»ï¼‰
- ä»»åŠ¡ï¼š
  - [x] `SymbolResolver`ï¼šExact â†’ ExactIgnoreCase â†’ Suffix â†’ Wildcard â†’ Fuzzy ç®¡çº¿
  - [x] Ambiguous æ ‡è®°ï¼ˆç®€å•åå¤šåç¼€ï¼šå…¨é‡æ”¶é›†åå†æˆªæ–­å¹¶æ ‡è®°ï¼‰
  - [x] Fuzzy è·ç¦»é˜ˆå€¼ï¼šlen â‰¤12 â†’1ï¼›>12 â†’2ï¼ˆäºŒç»´ DPï¼Œç§»é™¤ä¸å®‰å…¨æ—©é€€ï¼‰
  - [x] CLI `resolve` å‘½ä»¤ï¼ˆ--limit / --jsonï¼Œé€€å‡ºç ï¼š0 æˆåŠŸã€2 ç¼ºç´¢å¼•ã€3 æœªæ‰¾åˆ°ï¼‰
  - [x] å¤ç”¨æ¨¡å¼æ‰©å±•ï¼šCLI çº§å·²æœ‰ exists|timestamp|hash|noneï¼ˆä¸è§£æå…±å­˜éªŒè¯ï¼‰
- æµ‹è¯•ï¼š
  - [x] åŸºç¡€ 7 ç”¨ä¾‹ï¼ˆExact/IgnoreCase/Suffix/Wildcard/Fuzzy/NotFound/Ambiguousï¼‰
  - [x] é«˜çº§ 21â†’åˆè®¡ 28 ç”¨ä¾‹ï¼šæ’åºä¸æˆªæ–­ç¨³å®šã€Wildcard ç¦ç”¨ Fuzzyã€é˜ˆå€¼è¾¹ç•Œã€`*` æˆªæ–­ã€FQN tie-breakã€é•¿åº¦å·®æ—©é€€ã€æˆªæ–­ä¸‹ä» Ambiguousã€è·ç¦»=2 ä¿®å¤ã€‚
  - [x] Levenshtein è¯¯åˆ¤å›å½’æµ‹è¯•ï¼ˆè·ç¦»=2 çœŸå®å‘½ä¸­ï¼‰ã€‚
 - éªŒè¯ï¼šå…¨éƒ¨ 28 æµ‹è¯•é€šè¿‡ï¼›CLI è¾“å‡ºå« IsAmbiguous æ ‡è®°ã€‚

### S5 Watcher & å¢é‡
- ä»»åŠ¡ï¼š
  - [x] FileSystemWatcher + 400ms debounce
  - [x] Batch å¤„ç†é€»è¾‘ & ç»Ÿè®¡ lastIncrementalMs
  - [x] å…¨å˜æ›´åˆ†ç±»å¸ƒå°”åˆ¤æ–­ + outlineVersion++
  - [x] å¢é‡é“¾è·¯æ‰€æœ‰æ–‡ä»¶/ç›®å½•æ“ä½œå·²é€‚é… IFileSystemï¼ŒCLI/æµ‹è¯•å¯çµæ´»æ³¨å…¥
  - [x] ImpactAnalyzer æ–‡ä»¶å­˜åœ¨æ€§åˆ¤æ–­é€‚é… IFileSystem
  - [x] Core å±‚ IndexStore/AtomicFile/IndexReuseDecider ç­‰ IO é€‚é…ï¼ˆå¯é€‰/åç»­ï¼‰
- æ€§èƒ½æµ‹é‡ï¼šä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶è®¡æ—¶ <300msã€‚

### S6 Prompt çª—å£ (Outline Only)
- ä»»åŠ¡ï¼š
  - [x] AccessTracker: æœ€è¿‘è®¿é—® LRU
  - [x] Pinned åˆ—è¡¨ï¼ˆå†…å­˜+æŒä¹…åŒ– JSON ç®€åŒ–å¯å»¶åï¼‰
  - [x] WindowBuilder: Pinned > Focus(æœ€è¿‘ N=8) > Recent
  - [x] é¢„ç®—å­—ç¬¦ï¼šé»˜è®¤ 40k charï¼Œä¸Šæº¢è£å‰ª Recent
- éªŒè¯ï¼šè°ƒç”¨ä¸‰æ¬¡ outline è§¦å‘ Recent & Focus ç”Ÿæˆæ–‡ä»¶ã€‚

### S7 RPC æœåŠ¡
- [x] JSON-RPC Host (StreamJsonRpc over local TCPâ€”â€”é»˜è®¤ TCPï¼›ä¸å†ä½¿ç”¨ stdio)
- [x] Handlers: outline / resolve / search / status
- [x] ç®€å•å¥åº·æ—¥å¿—ï¼ˆå¯åŠ¨/å¼‚å¸¸/è¯·æ±‚æ—¥å¿—ï¼Œåç»­å¯æ‰©å±•ï¼‰
- [x] CLI ä½¿ç”¨ RPC å–å¾— outlineï¼ˆâœ… ç«¯åˆ°ç«¯è”è°ƒéªŒè¯å®Œæˆï¼‰
- [x] è‡ªåŠ¨ç´¢å¼•ç»´æŠ¤ï¼šæœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨å‘ç°å·¥ä½œåŒºã€æ„å»º/å¤ç”¨ç´¢å¼•
- [x] LLMæ˜¾ç¤ºå™¨ï¼šè‡ªåŠ¨æ›´æ–° `.github\copilot-instructions.md`
- éªŒè¯ï¼šCLI ä½¿ç”¨ RPC å–å¾— outlineã€‚

> âœ… **å·²å®Œæˆç«¯åˆ°ç«¯éªŒè¯**ï¼šService å…·å¤‡å®Œæ•´çš„ S1-S3 ç´¢å¼•æ„å»ºèƒ½åŠ›ï¼Œæ”¯æŒè‡ªåŠ¨å·¥ä½œåŒºå‘ç°ã€ç´¢å¼•æ„å»º/å¤ç”¨ã€TCP RPCæœåŠ¡ã€‚CLI æˆåŠŸé€šè¿‡ RPC è°ƒç”¨ status/resolve/search/outline å››å¤§åŠŸèƒ½ã€‚å®ç°äº†"æ— è„‘ä½¿ç”¨"çš„ç”¨æˆ·ä½“éªŒã€‚

### S8 CLI å·¥å…·
- ä»»åŠ¡ï¼š
  - [x] å­å‘½ä»¤ï¼šresolve / outline / search / statusï¼ˆâœ… å·²å®ç°å¹¶éªŒè¯ï¼‰
  - [ ] å­å‘½ä»¤ï¼šwindow / pin / unpin / dismissï¼ˆå¾…S6å®Œæˆåé›†æˆï¼‰
  - [ ] å­å‘½ä»¤ï¼šdaemon start|stopï¼ˆåç»­S8.5å®ç°ï¼‰
  - [ ] å®ˆæŠ¤è¿›ç¨‹ï¼šå†™ `daemon.pid`ï¼Œæ£€æµ‹å·²è¿è¡Œ
- éªŒè¯ï¼šè„šæœ¬æ‰§è¡Œé¡ºåºï¼ˆä¸»æ–‡æ¡£ Â§16ï¼‰ã€‚

> âœ… **æ ¸å¿ƒCLIåŠŸèƒ½å·²å®Œæˆ**ï¼šresolve/outline/search/status å››å¤§æ ¸å¿ƒRPCå‘½ä»¤å‡å¯æ­£å¸¸å·¥ä½œï¼Œæ”¯æŒ `--rpc-host` å’Œ `--rpc-port` å‚æ•°ã€‚ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯é€šè¿‡ï¼Œç”¨æˆ·å¯é€šè¿‡CLIè·å–321ä¸ªå·²ç´¢å¼•ç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚

### S9 æµ‹è¯•ä¸æ€§èƒ½
- ä»»åŠ¡ï¼š
  - [ ] æŒ‰æµ‹è¯•é™„å½•å»ºç«‹ fixtures
  - [ ] Baseline outline æ–‡ä»¶ï¼ˆé¢„æœŸ hashï¼‰
  - [ ] æ€§èƒ½æµ‹é‡ helper + è¾“å‡ºæ—¥å¿—æ¡ç›®
- éªŒè¯ï¼šCI / æœ¬åœ°è¿è¡Œç»¿ã€‚

### S10 ç¨³å®šåŒ–
- ä»»åŠ¡ï¼š
  - [ ] README / å¿«é€Ÿå¼€å§‹ / æ¶æ„ç¤ºæ„
  - [ ] æ—¥å¿—è½®è½¬æ£€æŸ¥ï¼ˆ>5MB renameï¼‰
  - [ ] å†…å­˜ä¸ hit ratio é‡‡æ · sanity
  - [ ] æ¸…ç† TODO æ ‡è®°ï¼ˆå…è®¸å°äº10ä¸ªæ®‹ç•™ï¼‰
- éªŒè¯ï¼šDoD åˆ—è¡¨æ‰“å‹¾ã€‚

---
## æ»šåŠ¨è¿›åº¦ä¸é‡Œç¨‹ç¢‘
| Session | Planned Start | Actual Start | Planned Finish | Actual Finish | Status | Notes |
|---------|---------------|--------------|----------------|---------------|--------|-------|
| S1 | 2025-09-02 | 2025-09-02 | 2025-09-02 | 2025-09-02 | âœ… | åˆæ¬¡åŠ è½½è€—æ—¶>5s, å¾…åç»­å¹¶è¡Œ/å»¶è¿Ÿç¬¦å·è§£æä¼˜åŒ– |
| S2 | 2025-09-02 | 2025-09-02 | 2025-09-02 | 2025-09-02 | âœ… | Hash/Outline å®ç°+å•æµ‹ä¿®å¤ & è°ƒè¯•å¼€å…³æ·»åŠ  |
| S3 | 2025-09-02 | 2025-09-02 | 2025-09-02 | 2025-09-02 | âœ… | Index+AtomicIO+åŸºæœ¬å¤ç”¨ |
| S3.5 | 2025-09-02 | 2025-09-02 | 2025-09-02 | 2025-09-02 | âœ… | æ—¶é—´æˆ³å¿«é€Ÿå¤±æ•ˆ (FileManifest) |
| S4 | 2025-09-02 | 2025-09-02 | 2025-09-02 | 2025-09-02 | âœ… | ç¬¦å·è§£æ + CLI resolve + é«˜çº§æµ‹è¯•è¦†ç›– |
| S5 | 2025-09-02 | 2025-09-02 | 2025-09-02 | 2025-09-02 | âœ… | å¢é‡å¤„ç† + æ–‡ä»¶ç›‘æ§ |
| S6 | 2025-09-02 | 2025-09-02 | 2025-09-02 | 2025-09-02 | âœ… | Promptçª—å£ + AccessTracker |
| S7 | 2025-09-04 | 2025-09-04 | 2025-09-04 | 2025-09-04 | âœ… | RPCæœåŠ¡ + è‡ªåŠ¨ç´¢å¼•ç»´æŠ¤ + LLMæ˜¾ç¤ºå™¨ |
| S8 | 2025-09-04 | 2025-09-04 | 2025-09-04 | 2025-09-04 | ğŸŸ¡ | CLIæ ¸å¿ƒå‘½ä»¤å®Œæˆï¼Œå®ˆæŠ¤è¿›ç¨‹ç®¡ç†å¾…å®ç° |
| S9 | | | | | â˜ | |
| S10 | | | | | â˜ | |

Milestones:
- M1 (S1-S3) åˆæ¬¡ç´¢å¼•å¯é‡å¯å¤ç”¨
- M2 (S4-S5) å¢é‡ + è§£æé—­ç¯
- M3 (S6-S7) æœåŠ¡åŒ– & Prompt
- M4 (S8-S9) å…¨ CLI + æµ‹è¯• & æ€§èƒ½è¾¾æ ‡
- GA (S10) ç¨³å®šäº¤ä»˜

---
## é£é™©ç‡ƒå°½è¡¨
| é£é™© | å½±å“ | å½“å‰ç­–ç•¥ | è§¦å‘ç›‘æ§ | çŠ¶æ€ |
|------|------|----------|----------|------|
| åˆæ¬¡ç´¢å¼•è¶…æ—¶ | å»¶è¿Ÿå¯åŠ¨ | åˆ†æ‰¹ hash, æ—¥å¿—è­¦å‘Š | initialIndexDurationMs | æœªè§¦å‘ |
| å¢é‡ >300ms | ä½“éªŒä¸‹é™ | Debounce + ä¼˜åŒ– hash | lastIncrementalMs | æœªè§¦å‘ |
| è§£ææ­§ä¹‰å¤š | CLI ä½“éªŒå·® | æ’åº+æç¤ºå»ºè®® | Ambiguous è®¡æ•° | æœªè§¦å‘ |
| æ—¥å¿—è¿‡å¤§ | IO å½±å“ | 5MB è½®è½¬ | æ–‡ä»¶å¤§å°ç›‘æ§ | æœªè§¦å‘ |
| å†…å­˜è†¨èƒ€ | ç¨³å®šæ€§ | æ— ç¼“å­˜ä¸Šé™ â†’ LRU | memoryMB | æœªè§¦å‘ |
| æ—¶é—´æˆ³ç²¾åº¦ç¢°æ’ | å˜æ›´è¯¯åˆ¤å¤ç”¨ | åç»­å¼•å…¥å¯é€‰å†…å®¹å“ˆå¸Œ | reuseMismatchCount | æœªè§¦å‘ |

---
## åº¦é‡é‡‡é›†æ¸…å•
| æŒ‡æ ‡ | é‡‡é›†ç‚¹ | è´£ä»»ç»„ä»¶ | å®Œæˆ |
|------|--------|----------|------|
| initialIndexDurationMs | å…¨é‡ç»“æŸ | IndexBuilder | â˜ |
| lastIncrementalMs | æ¯æ‰¹å | IncrementalProcessor | â˜ |
| watcherQueueDepth | Status æŸ¥è¯¢ | WatcherBatcher | â˜ |
| outlineCacheHitRatio | Outline è¯·æ±‚ | OutlineCache | â˜ |
| memoryMB | Status æŸ¥è¯¢ | StatusProvider | â˜ |

---
## å¢é‡ / å¤±æ•ˆç­–ç•¥å±‚çº§è§„åˆ’ (Added S3.5)
| Level | åç§° | åˆ¤å®šç­–ç•¥ | è¡Œä¸º | é€‚ç”¨é˜¶æ®µ | çŠ¶æ€ |
|-------|------|----------|------|----------|------|
| L0 | Exists Only | ä»…æ£€æµ‹ index.json æ˜¯å¦å­˜åœ¨ | æ°¸è¿œå¤ç”¨æˆ–å…¨é‡é‡å»º | S3 åˆå§‹ | å½’æ¡£ |
| L1 | Timestamp Quick Invalidation | FileManifest: è·¯å¾„ + LastWriteUtcTicks å…¨åŒ¹é… | è‹¥å…¨éƒ¨åŒ¹é…â†’å¤ç”¨ï¼›ä»»ä¸€ä¸åŒâ†’å…¨é‡é‡å»º | S3.5 | å·²å®ç° |
| L2 | Diff Collection | åœ¨ L1 åŸºç¡€æ”¶é›† changedFiles åˆ—è¡¨ | ä»æ‰§è¡Œå…¨é‡ï¼Œä½†è¾“å‡ºå·®å¼‚æ—¥å¿—æŒ‡æ ‡ | è¿‡æ¸¡åˆ° S5 | å¾…å®š |
| L3 | Partial Incremental | é’ˆå¯¹ changedFiles é‡æ–°å“ˆå¸Œå—å½±å“ç±»å‹ / æ›´æ–° Index å­é›† | å±€éƒ¨æ›´æ–° manifest & outlines | S5 | è§„åˆ’ |
| L4 | Optimized Incremental | å¹¶è¡Œ + Debounce + æ‰¹é‡ç»Ÿè®¡ (lastIncrementalMs, changedTypeCount) | ä½å»¶è¿Ÿè¿­ä»£ | S5+ | è§„åˆ’ |
| L5 | Hybrid Hash Cache | ç»“æ„/å®ç°å“ˆå¸Œåˆ†å±‚ç¼“å­˜ + çƒ­ç±»å‹ä¼˜å…ˆ | é™ä½çƒ­åŒºé‡å»ºæˆæœ¬ | S6+ | æ¦‚å¿µ |

è¯´æ˜ï¼šå½“å‰å¤„äº L1ï¼›è¿›å…¥ S4 å‰æ— éœ€æ›´å¤æ‚ç­–ç•¥ã€‚S5 å®ç° L3 æ—¶éœ€ï¼š
1) å˜æ›´åˆ†ç±» (æ–°å¢/ä¿®æ”¹/åˆ é™¤/é‡å‘½å)
2) æ˜ å°„ç±»å‹â†’æ–‡ä»¶çš„åå‘ç´¢å¼• (å¯æ´¾ç”Ÿè‡ª TypeEntry.Files æ„å»ºå†…å­˜å­—å…¸)
3) å—å½±å“ç±»å‹å“ˆå¸Œ + Outline å±€éƒ¨é‡å†™ + NameMaps/FqnIndex æ›´æ–°
4) Manifest å¢é‡æ›´æ–°ï¼ˆæ·»åŠ /ç§»é™¤/æ›´æ–°æ—¶é—´æˆ³ï¼‰
5) æŒ‡æ ‡ï¼šlastIncrementalMs / changedTypeCount / reuseMismatchCount

é£é™©ç¼“è§£è·¯å¾„ï¼š
- æ—¶é—´æˆ³è¯¯åˆ¤ï¼šæ·»åŠ å¯é€‰ ContentHash (å°æ–‡ä»¶é˜ˆå€¼ï¼Œæˆ–æŒ‰æ¦‚ç‡æŠ½æ ·)
- æ‰¹é‡é£æš´ï¼šDebounce èšåˆ <=400msï¼›è¶…å‡ºä¸Šé™ï¼ˆä¾‹å¦‚ >N æ–‡ä»¶ï¼‰å›é€€å…¨é‡
- å“ˆå¸Œé€€åŒ–ï¼šç»“æ„å“ˆå¸Œå¤±è´¥ fallback åˆ° PublicImplHash + æ–‡ä»¶é•¿åº¦


---
(End of CodeCortex Phase1 Sessions Plan)

---
## S7 å®æ–½è¡¥å……è¯´æ˜ï¼šRPC ä¼ è¾“é€‰æ‹©æ›´æ–°
### é€‰æ‹©åŸå› 
- æœåŠ¡è¿›ç¨‹ä¸ºå¸¸é©»ï¼ˆdaemonï¼‰ï¼ŒCLI ä¸ºä¸€æ¬¡æ€§å‰ç«¯è¿›ç¨‹ï¼›stdio éš¾ä»¥è¿›è¡Œè·¨è¿›ç¨‹æœåŠ¡å‘ç°ä¸å¤šå®¢æˆ·ç«¯å¹¶å‘ç®¡ç†ã€‚
- TCP æœ¬åœ°å›ç¯ï¼ˆ127.0.0.1ï¼‰è¿æ¥æ›´ç¬¦åˆâ€œé•¿æœŸè¿è¡Œ + çŸ­è¿›ç¨‹è°ƒç”¨â€çš„æ¨¡å‹ï¼Œæ˜“äºå¥åº·æ£€æŸ¥ã€ç«¯å£æ¢æµ‹ä¸åç»­å¤šè¯­è¨€å®¢æˆ·ç«¯æ‰©å±•ã€‚

### å½“å‰å®ç°
- ä¼ è¾“ï¼šStreamJsonRpc over TCPï¼ˆNerdbank.Streamsï¼‰ã€‚
- ç›‘å¬ï¼šé»˜è®¤ 127.0.0.1:9000ï¼ˆå¯é€šè¿‡ CLI é€‰é¡¹è¦†ç›–ï¼‰ã€‚
- CLIï¼š`outline/resolve/search/status` ç­‰å­å‘½ä»¤å‡æ”¯æŒ `--rpc-host` ä¸ `--rpc-port`ã€‚

### ä½¿ç”¨ç¤ºä¾‹
- å¯åŠ¨æœåŠ¡ï¼šå¸¸é©»äºæœ¬æœº 127.0.0.1:9000ï¼Œå¹¶è¾“å‡ºå¥åº·æ—¥å¿—ã€‚
- è°ƒç”¨ CLIï¼ˆç¤ºä¾‹ï¼‰ï¼š
  - `codecortex outline <IdOrFqn> --rpc-host 127.0.0.1 --rpc-port 9000`

### åç»­è®¡åˆ’
- å®ˆæŠ¤è¿›ç¨‹ç®¡ç†ï¼š`daemon start|stop`ï¼ˆS8ï¼‰ï¼Œå¹¶å†™å…¥/è¯»å– `daemon.pid`ã€‚
- ç«¯å£å ç”¨ä¸è‡ªåŠ¨é€‰æ‹©ç­–ç•¥ï¼šæ£€æµ‹ 9000 è¢«å ç”¨æ—¶å›é€€åˆ°ç©ºé—²ç«¯å£å¹¶è¾“å‡ºæç¤º/å†™å…¥ç«¯ç‚¹æ–‡ä»¶ä»¥ä¾›å‘ç°ã€‚

## S4 å®æ–½è¡¥å……è¯´æ˜
### å®ç°è¦ç‚¹
- `SymbolResolver` æ”¯æŒåŒ¹é…é¡ºåºï¼šExact â†’ ExactIgnoreCase â†’ Suffix â†’ Wildcard â†’ Fuzzyã€‚
- Fuzzy é˜ˆå€¼ï¼šæŸ¥è¯¢é•¿åº¦ â‰¤12 â†’ 1ï¼›>12 â†’ 2ã€‚
- æ­§ä¹‰æ ‡è®°ï¼šå½“æŸ¥è¯¢ä¸ºç®€å•åä¸” suffix å…¨é‡åŒ¹é…ç»“æœ >1 æ—¶ï¼Œä¸ºè¿™äº›ç»“æœè®¾ç½® `IsAmbiguous=true`ï¼ˆå³ä¾¿ limit æˆªæ–­åä»ä¿ç•™æ ‡è®°ï¼šå…ˆæ”¶é›†å…¨é‡å†è£å‰ªï¼‰ã€‚
- å¼•å…¥ `_byId` ç¼“å­˜é¿å…é‡å¤çº¿æ€§æŸ¥æ‰¾ï¼›ç§»é™¤åŸä¸ç¨³å®šæ—©é€€çš„ Levenshteinï¼›æ›¿æ¢ä¸ºä¿è¯æ­£ç¡®æ€§ 2D DPï¼ˆä»å«é˜ˆå€¼å‰ªæï¼‰ã€‚
- CLI æ–°å¢ `resolve`ï¼š`codecortex resolve <query> [--limit N] [--json]`ï¼Œé€€å‡ºç ï¼š0=æˆåŠŸï¼Œ2=ç¼ºå°‘ç´¢å¼•ï¼Œ3=æœªæ‰¾åˆ°ã€‚

### æ–°å¢/æ›´æ–°æµ‹è¯•
`SymbolResolverTests` è¦†ç›–åŸºç¡€ 7 ç”¨ä¾‹ï¼›`SymbolResolverAdvancedTests` è¦†ç›–ï¼š
1. Limit æˆªæ–­ä¸æ’åºç¨³å®š
2. Wildcard ç¦ç”¨ Fuzzy
3. Fuzzy é˜ˆå€¼è¾¹ç•Œï¼ˆé•¿åº¦ 13 æ”¯æŒè·ç¦»=2ï¼›é•¿åº¦ 12 æ‹’ç»è·ç¦»=2ï¼‰
4. å…¨é€šé… `*` é™åˆ¶æˆªæ–­
5. åŒ Rank tie-break (FQN æ’åº)
6. é•¿åº¦å·®å¯¼è‡´æ—©é€€ï¼ˆä¸äº§ç”Ÿ Fuzzyï¼‰
7. æˆªæ–­æƒ…å†µä¸‹ Ambiguous ä»æ ‡è®°

### è´¨é‡çŠ¶æ€
- å…¨éƒ¨ 28 ä¸ªæµ‹è¯•é€šè¿‡ï¼ˆå«é«˜çº§ 8 é¡¹ï¼‰ã€‚
- è§£ææ€§èƒ½ï¼šå½“å‰å®ç° O(n * m) DPï¼›Phase1 ç±»å‹è§„æ¨¡ä¸‹å¯æ¥å—ï¼›åç»­è‹¥éœ€ä¼˜åŒ–å¯æ›¿æ¢ä¸º banded ç®—æ³•é‡æ–°å¼•å…¥å®‰å…¨æ—©é€€ã€‚

### åç»­å¯æ¼”è¿›ç‚¹
- åŒºåˆ† `resolve` ä¸ `search`ï¼ˆæ›´å®½æ¾è¿”å›ï¼‰ã€‚
- å¯é…ç½® Fuzzy é˜ˆå€¼ä¸å¼€å…³ï¼ˆæœªæ¥ `SymbolResolverOptions`ï¼‰ã€‚
- å¢åŠ è§£ææ—¥å¿—ç»Ÿè®¡ï¼ˆåŒ¹é…é˜¶æ®µè®¡æ•°ã€è·ç¦»åˆ†å¸ƒï¼‰ã€‚

---
## Dev Notes / å¼€å‘ç»éªŒè®°å½• (æ–°å¢)
> æœ¬èŠ‚ç”¨äºè®°å½•åœ¨å®ç°ä¸è°ƒè¯•è¿‡ç¨‹ä¸­å‡ºç°çš„æ˜“é”™ç‚¹ã€æ“ä½œä¹ æƒ¯æé†’ä¸åç»­æ”¹è¿›æƒ³æ³•ã€‚

### æµ‹è¯•è¿­ä»£æ³¨æ„äº‹é¡¹
- é¿å…åœ¨ä¿®æ”¹æ ¸å¿ƒå®ç°åç«‹å³ä½¿ç”¨ `dotnet test --no-build` è¿›è¡ŒéªŒè¯ï¼›ä¼šå¯¼è‡´æ—§äºŒè¿›åˆ¶è¢«å¤ç”¨è€Œäº§ç”Ÿâ€œä»£ç å·²æ”¹ä½†è¡Œä¸ºæœªå˜â€çš„å‡è±¡ã€‚
- æ¨èå·¥ä½œæµï¼š
  1. `dotnet test -c Debug -v minimal`ï¼ˆé»˜è®¤å…ˆæ„å»ºï¼‰
  2. å¦‚éœ€åŠ é€Ÿï¼Œä»…åœ¨ç¡®è®¤å®ç°ä»£ç æœªæ”¹åŠ¨ã€åªå¢åˆ æµ‹è¯•æ–‡ä»¶æ—¶ä½¿ç”¨ `--no-build`ã€‚
  3. é¢‘ç¹æ ¸å¿ƒç®—æ³•ï¼ˆè§£æ/å“ˆå¸Œï¼‰è¿­ä»£é˜¶æ®µç¦ç”¨ `--no-build`ã€‚

### æ¨¡ç³ŠåŒ¹é…ç®—æ³•æ¼”è¿›
- åˆç‰ˆæ—©é€€ï¼ˆè¡Œæœ€å°å€¼ > limit å³é€€å‡ºï¼‰åœ¨è·ç¦»=2 åœºæ™¯ä¸‹å¯èƒ½è¯¯åˆ¤ï¼›åŸå› ï¼šè¡Œé¦–åˆå§‹åŒ–å€¼åå¤§å¯¼è‡´æå‰æ”¾å¼ƒï¼›ç°å·²ç§»é™¤å¹¶æ›¿æ¢å®Œæ•´ DPã€‚
- è‹¥åç»­éœ€è¦æ€§èƒ½æå‡ï¼Œå¯å®ç° banded DPï¼šä»…è®¡ç®— |i-j|<=limit å¸¦å®½åŒºåŸŸï¼Œç»“åˆå®‰å…¨è¡Œ/åˆ—æœ€å°å€¼åˆ¤æ–­ã€‚

### æ­§ä¹‰æ ‡è®°ç­–ç•¥
- å…ˆæ”¶é›†å…¨é‡ suffix å†æˆªæ–­ï¼Œä¿è¯ Ambiguous æ ‡è®°ç¨³å®šï¼›é¿å…ä¾èµ–æˆªæ–­åé›†åˆå¤§å°ã€‚
- åç»­å¦‚å¢åŠ  Fuzzy Ambiguousï¼Œå¯å¤ç”¨ç›¸åŒæ¨¡å¼ï¼ˆå…ˆå…¨é‡å†æˆªï¼‰ã€‚

### å¤ç”¨ç­–ç•¥æ¼”è¿›æé†’
- å½“å‰ reuse-mode å·²æ”¯æŒï¼šexists|timestamp|hash|noneã€‚
- è®¡åˆ’ä¸­çš„ autoï¼šæ ¹æ®æ–‡ä»¶æ•°é˜ˆå€¼ä¸å˜æ›´æ¦‚ç‡è‡ªé€‚åº”é€‰æ‹© timestamp æˆ– hashã€‚

### æ¨èè¿½åŠ æŒ‡æ ‡
| æŒ‡æ ‡ | è¯´æ˜ | ä»·å€¼ |
|------|------|------|
| resolveDurationMs | å•æ¬¡è§£æè€—æ—¶ | è¯†åˆ«è§£æé€€åŒ– | 
| fuzzyCandidates | è¿›å…¥æ¨¡ç³Šé˜¶æ®µçš„å€™é€‰æ•° | è°ƒä¼˜é˜ˆå€¼ | 
| wildcardResultCount | é€šé…ç¬¦åˆå§‹åŒ¹é…æ•°é‡ | è¯„ä¼°æ˜¯å¦éœ€è¦åˆ†é¡µ | 

### æ½œåœ¨å·¥å…·æ”¹è¿›
- å¢åŠ æœ¬åœ°å‘½ä»¤åˆ«åè„šæœ¬ï¼š`alias dtest="dotnet test -c Debug"` å‡å°‘è¯¯ç”¨ `--no-build`ã€‚
- åœ¨æµ‹è¯•é¡¹ç›®æ·»åŠ è‡ªå®šä¹‰å‰ç½®è„šæœ¬ï¼Œæ£€æµ‹æ ¸å¿ƒæºç æ—¶é—´æˆ³æ–°äºæµ‹è¯• DLL æ—¶æ‹’ç»æ— æ„å»ºæµ‹è¯•ã€‚

---
