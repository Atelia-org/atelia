# MemoTree 核心类型设计文档拆分计划

> **计划版本**: v1.0  
> **创建日期**: 2025-07-24  
> **预计完成**: 2025-07-31  
> **执行方式**: 多个LLM会话逐步执行  

## 📋 项目概述

### 当前状况
- **源文档**: `docs/Core_Types_Design.md` (3116行)
- **问题**: 文档过于庞大，不利于LLM处理和人工维护
- **目标**: 拆分为功能内聚的小文档，配合C# partial class

### 拆分原则
1. **功能内聚**: 每个文档专注单一功能领域
2. **施工阶段**: 按开发优先级组织文档
3. **LLM友好**: 每个文档控制在500-800行以内
4. **依赖清晰**: 明确文档间的依赖关系

## 🎯 拆分策略

### 策略A: 按施工阶段拆分 (推荐)
```
Phase1_Foundation/     # 第一阶段：基础设施
Phase2_Storage/        # 第二阶段：存储层
Phase3_Services/       # 第三阶段：服务层
Phase4_Integration/    # 第四阶段：集成层
Phase5_Enterprise/     # 第五阶段：企业特性
```

### 策略B: 按功能圈层拆分 (备选)
```
Core_DataTypes/        # 核心数据类型
Storage_Abstractions/ # 存储抽象
Business_Logic/       # 业务逻辑
External_Integration/ # 外部集成
Infrastructure/       # 基础设施
```

**选择**: 采用策略A，因为更符合开发流程

## 📁 详细拆分计划

### Phase 1: Foundation (基础设施阶段)

#### 1.1 Phase1_CoreTypes.md ✅ (已完成)
- **内容**: 基础数据类型、枚举、标识符
- **行数**: ~300行
- **状态**: 已创建示例

#### 1.2 Phase1_Constraints.md
- **内容**: 约束定义、验证规则、系统限制
- **源位置**: 原文档第11节、NodeConstraints、SystemLimits
- **预计行数**: ~200行

#### 1.3 Phase1_Exceptions.md  
- **内容**: 异常类型定义、错误处理
- **源位置**: 原文档第7节
- **预计行数**: ~150行

#### 1.4 Phase1_Configuration.md
- **内容**: 配置选项、系统设置
- **源位置**: 原文档第6节
- **预计行数**: ~400行

### Phase 2: Storage (存储层阶段)

#### 2.1 Phase2_StorageInterfaces.md
- **内容**: 基础存储接口定义
- **源位置**: 原文档第3.1节 (INodeMetadataStorage, INodeContentStorage等)
- **预计行数**: ~500行

#### 2.2 Phase2_RelationStorage.md
- **内容**: 关系存储和层次结构存储
- **源位置**: 原文档第3.1节 (INodeRelationStorage, INodeHierarchyStorage等)
- **预计行数**: ~400行

#### 2.3 Phase2_ViewStorage.md
- **内容**: 视图状态存储、缓存策略
- **源位置**: 原文档第3.1节末尾、第10节部分
- **预计行数**: ~300行

### Phase 3: Services (服务层阶段)

#### 3.1 Phase3_CoreServices.md
- **内容**: 核心业务服务接口
- **源位置**: 原文档第4.1节 (ICognitiveCanvasService等)
- **预计行数**: ~400行

#### 3.2 Phase3_RelationServices.md
- **内容**: 关系管理服务
- **源位置**: 原文档第3.2节
- **预计行数**: ~500行

#### 3.3 Phase3_EditingServices.md
- **内容**: 编辑操作、LOD生成服务
- **源位置**: 原文档第3.4节、第4.2节
- **预计行数**: ~600行

#### 3.4 Phase3_RetrievalServices.md
- **内容**: 检索和搜索服务
- **源位置**: 原文档第3.3节
- **预计行数**: ~300行

### Phase 4: Integration (集成层阶段)

#### 4.1 Phase4_ToolCallAPI.md
- **内容**: LLM工具调用接口
- **源位置**: 原文档第5节
- **预计行数**: ~400行

#### 4.2 Phase4_ExternalIntegration.md
- **内容**: 外部数据源集成、Roslyn集成
- **源位置**: 原文档第4.3节
- **预计行数**: ~600行

#### 4.3 Phase4_VersionControl.md
- **内容**: 版本控制服务
- **源位置**: 原文档第3.3节
- **预计行数**: ~200行

### Phase 5: Enterprise (企业特性阶段)

#### 5.1 Phase5_Security.md
- **内容**: 权限、安全、审计
- **源位置**: 原文档第13节
- **预计行数**: ~600行

#### 5.2 Phase5_EventSystem.md
- **内容**: 事件系统、发布订阅
- **源位置**: 原文档第8节
- **预计行数**: ~400行

#### 5.3 Phase5_Performance.md
- **内容**: 性能监控、缓存、指标
- **源位置**: 原文档第10节、第14节
- **预计行数**: ~500行

#### 5.4 Phase5_Extensions.md
- **内容**: 插件系统、扩展机制
- **源位置**: 原文档第12节
- **预计行数**: ~300行

#### 5.5 Phase5_Factories.md
- **内容**: 工厂模式、构建器模式
- **源位置**: 原文档第9节
- **预计行数**: ~300行

## 🔄 执行流程

### 每个会话的标准流程

1. **会话开始**
   - 阅读本计划文档
   - 确认当前要处理的文档
   - 检查依赖关系

2. **内容提取**
   - 从原文档提取指定章节内容
   - 保持代码完整性和注释
   - 确保类型定义完整

3. **文档创建**
   - 创建新的markdown文档
   - 添加适当的文档头部信息
   - 包含必要的交叉引用

4. **质量检查**
   - 验证代码语法正确性
   - 检查文档结构完整性
   - 确认内容覆盖完整

5. **进度更新**
   - 更新本计划文档的完成状态
   - 记录任何发现的问题
   - 为下一个会话准备信息

### 会话间协调机制

#### 状态跟踪文件
创建 `docs/splitting_progress.json` 跟踪进度：
```json
{
  "lastUpdated": "2025-07-24T10:00:00Z",
  "completedDocs": ["Phase1_CoreTypes.md"],
  "inProgress": "",
  "nextUp": "Phase1_Constraints.md",
  "issues": [],
  "totalProgress": "1/17"
}
```

#### 依赖关系图
```
Phase1_CoreTypes.md (✅)
├── Phase2_StorageInterfaces.md
├── Phase3_CoreServices.md
└── Phase4_ToolCallAPI.md

Phase1_Constraints.md
├── Phase2_StorageInterfaces.md
└── Phase3_EditingServices.md

Phase1_Exceptions.md
└── (所有其他文档)

Phase1_Configuration.md
└── (所有其他文档)
```

## 📝 文档模板

### 标准文档头部
```markdown
# MemoTree [功能名称] (Phase X)

> **版本**: v1.2  
> **创建日期**: 2025-07-24  
> **基于**: Core_Types_Design.md 第X节  
> **依赖**: [列出依赖的其他文档]  
> **状态**: 🚧 开发中 / ✅ 已完成  

## 概述
[简要说明本文档的内容和在整体架构中的作用]

## 实施优先级
1. **立即实现**: [最高优先级的类型]
2. **第一周**: [中等优先级的类型]  
3. **第二周**: [较低优先级的类型]

[具体内容...]

---
**下一阶段**: [下一个相关文档的链接]
**相关文档**: [相关文档的链接列表]
```

## ⚠️ 注意事项

### 执行时的关键点
1. **保持代码完整性**: 确保所有类型定义、接口、枚举都完整
2. **维护依赖关系**: 注意类型间的引用关系
3. **统一命名空间**: 保持命名空间的一致性
4. **文档交叉引用**: 添加适当的文档间链接

### 常见问题预防
1. **重复定义**: 避免同一类型在多个文档中定义
2. **缺失依赖**: 确保被引用的类型在依赖文档中存在
3. **版本不一致**: 保持所有文档的版本信息同步

### 质量标准
- 每个文档应该能够独立理解其功能范围
- 代码示例应该完整可编译
- 文档结构应该清晰易导航
- 交叉引用应该准确有效

## 🎯 成功标准

拆分完成后应该达到：
1. **17个功能内聚的文档**，每个500-800行
2. **清晰的依赖关系**，便于按阶段实施
3. **完整的类型覆盖**，无遗漏无重复
4. **LLM友好的结构**，便于理解和修改
5. **开发者友好的组织**，便于查找和维护

---

**开始执行**: 下一个会话请处理 `Phase1_Constraints.md`  
**当前进度**: 1/17 (5.9%)
