# MemoTree 用户体验优化路线图

> **创建日期**: 2025-08-10  
> **维护者**: 刘德智  
> **目的**: 系统性规划MemoTree的用户体验优化功能  

## 🎯 当前状态总结

### ✅ 已完成的体验优化 (2025-08-10)
- **JSON序列化优化**: 中文字符不再转义，保持NodeId的CJK原文形式
- **NodeId完整显示**: 显示时展示完整ID，不再截断为8字符
- **Markdown标题层级**: 使用`#`数量表示层次深度，配合缩进双重视觉引导
- **LOD状态统一显示**: 所有节点显示`[Gist/Summary/Full]`状态标记

### 🔧 当前渲染效果
```markdown
# MemoTree认知空间 [6 nodes, 1 expanded, 46 chars]

## 测试根节点 [秒挛拿资域丑秆忠亏临误] [Full]
   这是我的第一个认知节点内容...

  ### 子节点1 [遮馋鄙央聊空蹬蛋季壑昧] [Gist]
    #### 孙子节点 [爽粤狰搓猪沫效澡跳甄物] [Gist]
  ### 子节点2 [慵细俨恒俾琪暨紧茯狄蝉] [Gist]
```

## 🚀 优化路线图

### Phase A: ViewState持久化 (高优先级)
**目标**: 实现视图状态的跨会话保存和恢复

**功能需求**:
- 展开/收起状态持久化到`.memotree/viewstates/`
- 支持多个命名视图（default, focus, review等）
- 视图状态版本控制和冲突解决
- CLI命令: `memotree view save/load/list`

**技术实现**:
- 扩展`MemoTreeViewState.cs`支持序列化
- 使用JSON格式存储，复用现有序列化配置
- 集成到`MemoTreeService.RenderViewAsync`

### Phase B: 智能ID匹配系统 (中优先级)
**目标**: 支持部分NodeId输入的智能匹配和歧义解决

**功能需求**:
- 4-8字符片段精确匹配完整NodeId
- 多匹配时的智能排序（最近使用、重要性）
- 歧义解决界面：列出候选项供用户选择
- CLI增强: 所有接受NodeId的命令支持片段匹配

**技术实现**:
- 创建`NodeIdResolver`服务
- 实现LRU缓存记录最近使用
- 扩展CLI参数解析支持模糊匹配

### Phase C: Token优化策略 (低优先级)
**目标**: 在保持功能完整的前提下优化token使用

**优化策略**:
1. **分级显示策略**:
   - Gist级别: 隐藏`[Gist]`标记（默认状态）
   - Summary级别: 显示`[Summary]`
   - Full级别: 显示`[Full]`

2. **NodeId长度绑定**:
   - Gist级别: 显示8字符片段
   - Summary级别: 显示完整ID
   - Full级别: 显示完整ID

3. **智能截断防冲突**:
   - 动态调整截断长度避免歧义
   - 冲突检测和自动扩展机制

## 🎨 渲染样式规范

### 标题层级规范
- **根节点**: `##` (2个#)
- **子节点**: `###` (3个#)
- **孙子节点**: `####` (4个#)
- **最大深度**: `######` (6个#，HTML标准)

### 状态标记规范
- **LOD状态**: `[Gist]` `[Summary]` `[Full]`
- **特殊状态**: `[LOADING]` `[ERROR]` `[EMPTY]`
- **操作提示**: 通过状态标记暗示可用操作

### 缩进规范
- **每级缩进**: 2个空格
- **内容缩进**: 标题下内容额外缩进3个空格
- **最大缩进**: 12个空格（6级深度）

## 🔮 头脑风暴功能

### 高级渲染功能
- **树形字符**: 可选的`├─,└,──,│`制表符渲染模式
- **颜色支持**: 终端颜色标记不同LOD级别
- **图标支持**: 节点类型图标（📝文档，💡想法，🔗链接）

### 智能交互功能
- **快速导航**: 基于标题的快速跳转
- **批量操作**: 选择多个节点进行批量expand/collapse
- **搜索高亮**: 搜索结果的高亮显示

### 性能优化功能
- **懒加载**: 大型树结构的按需加载
- **虚拟滚动**: 超长列表的性能优化
- **缓存策略**: 渲染结果缓存和增量更新

## 📋 实施计划

### 下一个会话目标
**Phase A: ViewState持久化**
- 设计ViewState存储格式
- 实现序列化/反序列化
- 集成到CLI命令
- 测试跨会话状态恢复

### 后续会话目标
- Phase B: 智能ID匹配系统
- Phase C: Token优化策略
- 头脑风暴功能的选择性实现

## 🎯 成功指标

### 用户体验指标
- **操作效率**: 常用操作的击键次数减少
- **认知负担**: 减少用户需要记忆的信息
- **错误率**: 减少因ID输入错误导致的操作失败

### 技术指标
- **响应速度**: 渲染和状态切换的延迟
- **存储效率**: 状态文件大小和读写性能
- **兼容性**: 跨平台和跨会话的一致性

---

> **备注**: 本文档将随着实施进展持续更新，记录实际实现中的发现和调整。
